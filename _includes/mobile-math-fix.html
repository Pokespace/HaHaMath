<!-- ç§»åŠ¨ç«¯æ•°å­¦å…¬å¼æ¸²æŸ“ä¿®å¤è„šæœ¬ -->
<script>
(function() {
  'use strict';
  
  // æ£€æµ‹å®‰å“æµè§ˆå™¨
  var isAndroid = /Android/i.test(navigator.userAgent);
  var isOldAndroid = /Android [1-4]/i.test(navigator.userAgent);
  
  if (isAndroid) {
    // å®‰å“è®¾å¤‡ç‰¹æ®Šå¤„ç†
    document.addEventListener('DOMContentLoaded', function() {
      
      // ä¸ºè€ç‰ˆæœ¬å®‰å“æä¾›é™çº§æ–¹æ¡ˆ
      if (isOldAndroid) {
        console.log('æ£€æµ‹åˆ°è€ç‰ˆæœ¬å®‰å“ï¼Œå¯ç”¨é™çº§æ–¹æ¡ˆ');
        
        // æ›¿æ¢å¤æ‚å…¬å¼ä¸ºç®€åŒ–ç‰ˆæœ¬
        var mathElements = document.querySelectorAll('*');
        for (var i = 0; i < mathElements.length; i++) {
          var element = mathElements[i];
          if (element.textContent && element.children.length === 0) {
            var text = element.textContent;
            
            // ç®€åŒ–ä¸€äº›å¤æ‚çš„LaTeXç¬¦å·
            text = text.replace(/\\mathbb\{([^}]+)\}/g, '$1');
            text = text.replace(/\\Rightarrow/g, '=>');
            text = text.replace(/\\complement_U/g, 'è¡¥é›†');
            text = text.replace(/\\cap/g, 'âˆ©');
            text = text.replace(/\\cup/g, 'âˆª');
            text = text.replace(/\\subseteq/g, 'âŠ†');
            text = text.replace(/\\subset/g, 'âŠ‚');
            text = text.replace(/\\mid/g, '|');
            
            if (text !== element.textContent) {
              element.textContent = text;
            }
          }
        }
      }
      
      // å¼ºåˆ¶é‡æ–°æ¸²æŸ“æ•°å­¦å…¬å¼
      setTimeout(function() {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
          MathJax.typesetPromise().then(function() {
            console.log('å®‰å“è®¾å¤‡æ•°å­¦å…¬å¼æ¸²æŸ“å®Œæˆ');
          }).catch(function(err) {
            console.error('å®‰å“è®¾å¤‡æ•°å­¦å…¬å¼æ¸²æŸ“å¤±è´¥:', err);
            showMathFallback();
          });
        } else {
          showMathFallback();
        }
      }, 1000);
    });
  }
  
  // æ˜¾ç¤ºé™çº§æç¤º
  function showMathFallback() {
    var mathElements = document.querySelectorAll('*');
    var hasMath = false;
    
    for (var i = 0; i < mathElements.length; i++) {
      if (mathElements[i].textContent.includes('$')) {
        hasMath = true;
        break;
      }
    }
    
    if (hasMath) {
      var notice = document.createElement('div');
      notice.style.cssText = 'background: #e3f2fd; border: 1px solid #2196f3; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 14px;';
      notice.innerHTML = 'ğŸ“± æ£€æµ‹åˆ°æ‚¨ä½¿ç”¨çš„æ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œå¦‚æœæ•°å­¦å…¬å¼æ˜¾ç¤ºå¼‚å¸¸ï¼Œè¯·å°è¯•åˆ·æ–°é¡µé¢æˆ–åˆ‡æ¢åˆ°æ¡Œé¢ç‰ˆæœ¬ã€‚';
      
      var content = document.getElementById('main-content') || document.body;
      content.insertBefore(notice, content.firstChild);
    }
  }
  
  // è§¦æ‘¸äº‹ä»¶ä¼˜åŒ–
  if (isAndroid) {
    document.addEventListener('touchstart', function() {
      // è§¦æ‘¸æ—¶é‡æ–°æ£€æŸ¥æ•°å­¦å…¬å¼æ¸²æŸ“
      setTimeout(function() {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
          MathJax.typesetPromise();
        }
      }, 100);
    });
  }
})();
</script>

<!-- å®‰å“æµè§ˆå™¨CSSä¿®å¤ -->
<style>
  /* å®‰å“æµè§ˆå™¨ç‰¹æ®Šæ ·å¼ä¿®å¤ */
  @media screen and (max-width: 768px) {
    /* ç¡®ä¿æ•°å­¦å…¬å¼ä¸ä¼šè¢«æˆªæ–­ */
    mjx-container {
      display: inline-block !important;
      margin: 0.1em 0 !important;
      max-width: 100% !important;
      overflow-x: auto !important;
      overflow-y: hidden !important;
    }
    
    /* è¡Œå†…å…¬å¼ä¼˜åŒ– */
    mjx-container[display="false"] {
      display: inline !important;
      margin: 0 !important;
    }
    
    /* å—çº§å…¬å¼ä¼˜åŒ– */
    mjx-container[display="true"] {
      display: block !important;
      margin: 1em 0 !important;
      text-align: center !important;
    }
    
    /* ä¿®å¤å®‰å“æµè§ˆå™¨çš„å­—ä½“æ¸²æŸ“é—®é¢˜ */
    mjx-math {
      font-family: "Times New Roman", serif !important;
    }
    
    /* ç¡®ä¿å…¬å¼åœ¨å°å±å¹•ä¸Šå¯è§ */
    .MathJax {
      font-size: 16px !important;
      line-height: 1.5 !important;
    }
  }
  
  /* é’ˆå¯¹å®‰å“å¾®ä¿¡æµè§ˆå™¨çš„ç‰¹æ®Šä¿®å¤ */
  @media screen and (max-width: 480px) {
    mjx-container {
      font-size: 14px !important;
    }
    
    mjx-container[display="true"] {
      overflow-x: scroll !important;
      -webkit-overflow-scrolling: touch !important;
    }
  }
</style> 